--- 

# - name: create the json from the template
#   template:
#     src: rg_policy.j2
#     dest: /tmp/rg_policy.json

# - name: Create Azure Policy 
#   azure.azcollection.azure_rm_resource:
#     provider: "ResourceGroups"
#     resource_type: resourcegroup
#     resource_name: "{{ rg_policy }}"
#     api_version: "2020-01-01"
#     body: "{{ lookup ('file', 'rg-policy.json') }}"
#   register: output
#   failed_when: output.rc == 0 

- name: trying with URI
  uri:
    url: "{{ policy_creation_url }}"
    method: PUT
    body_format: json
    body: "{{ lookup ('file', 'rg-policy.json') }}"


- name: debugging 
  debug:
    msg: "{{ output }}"

- name: Create Resource Group Policy
  azure.azcollection.azure_rm_devtestlabpolicy:
    resource_group: "{{ resource_group }}"
    lab_name: myLab
    policy_set_name: myPolicySet
    name: myPolicy
    fact_name: user_owned_lab_vm_count
    threshold: 5
